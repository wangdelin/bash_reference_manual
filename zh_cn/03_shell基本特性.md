03 shell基本特性
================

3.1 shell语法
-------------

### 3.1.1 shell操作

### 3.1.2 引用

引用用于删除某些字符或单词对shell的特殊含义。引用可用于禁止特殊字符的特殊处理，以防止保留字被识别，并防止参数扩展。

每个shell的元字符(查看02. 定义)对shell有特殊的含义，如果要表示自身，必须引用它。当命令历史扩展技术被使用时(查看9.3 历史扩展)，历史扩展字符(通常是'!'), 必须被引用以保护历史扩展。查看9.1 Bash历史技术，了解更多关于历史扩展的内容。

有3种引用机制: 转义字符，单引号和双引号。

#### 3.1.2.1 转义字符

'\' 不带引号的反斜杠是Bash的转义字符。它保留下一个字符的字面值，除了换行以外。如果\newline对出现，反斜杆本身不会被引用，\newline被视为一行延续(也就是说，它被从输入流中移除并被有效的忽略)。

#### 3.1.2.2 单引号

单引号('')可保留引号内每个字符的字面值。单引号不能放在单引号之间，即使是加了反斜杆也不行。

#### 3.1.2.3 双引号

双引号("")可保留引号内所有字符的字面值，除了以下字符以外，'$', '`', '\', 以及开启历史扩展以后的'!'字符。当shell在POSIX模式时(查看6.11 Bash POSIX模式), 双引号里面的'!'没有特殊的意义，即使开启了历史扩展。双引号内的'$', '`'字符保留其特殊含义(查看3.5 shell扩展)。反斜杆字符'\'仅在后面跟'$', '`', '"', '\', 或换行时有特殊意义。在双引号内部，后面跟上述的这些字符的反斜杆会被移除。前面没有特殊含义字符的反斜杆会被保持不变。双引号内前面有反斜杆的双引号可以能被引用。如果启用，则将执行历史扩展，除非使用反斜杠转义双引号中的"!"。"!"之前的反斜杠不会被删除。

在双引号中，特殊参数 '*' 和 '@' 有特殊的含义(查看3.5.3 shell参数扩展)。

#### 3.1.2.4 ANSI-C引用

$'string'形式的词会被特殊处理，它会被扩展为string，反斜杠转义的字符按ANSI C标准替换。反斜杠转义序列（如果存在）按照如下解码：

转义字符   | 说明
-----------|------------
\a         | 警告(响铃)
\b         | 退格
\e \E      | 一个转义字符(非ANSI C)
\f         | 换页
\n         | 换行
\r         | 回车
\t         | 水平制表符
\v         | 垂直制表符
\\\\       | 反斜杠
\'         | 单引号
\"         | 双引号
\?         | 问号
\nnn       | 值为八进制nnn表示的八位字符(1到3位八进制数)
\xHH       | 值为十六进制HH表示的八位字符(1到2位十六进制数)
\uHHHH     | 值为十六进制HHHH的Unicode(ISO/IEC 10646)的字符(1到4位十六进制数)
\UHHHHHHHH | 值为十六进制HHHHHHHH的Unicode(ISO/IEC 10646)的字符(1到8位十六进制数)
\cx        |control-x字符

扩展结果是被单引号的，就如'$'符号没有出现一样。

#### 3.1.2.5 特定区域翻译

双引号内的字符串前面加上'$'标志，会导致该字符串根据当前的locale来翻译。如果locale为C或者POSIX，那么'$'标志会被忽略。如果字符串被翻译和替代，该替代是双引号的。

一些系统使用由LC_MESSAGES shell变量选择的消息目录。其他一些通过shell变量TEXTDOMAIN来创建消息目录的名称，可能添加'.mo'后缀。如果你使用TEXTDOMAIN变量，你可能需要设置TEXTDOMAINDIR变量为消息目录文件的位置。另外也有一些同时使用这两种方式: TEXTDOMAINDIR/LC_MESSAGES/LC_MESSAGES/TEXTDOMAIN.mo。

### 3.1.3 注释

在非交互shell，或者`shopt`内置命令(查看 4.3.2 shopt内置命令)设置了interactive_comments选项的交互shell中，以"#"字符开头会导致该行上的所有字符被忽略。没有开启interactive_comments选项的交互shell不允许注释。交互shell中interactive_comments选项是默认开启的。查看6.3 交互shell，了解有关交互shell的描述。

3.2 shell命令
-------------

3.3 shell函数
-------------

3.4 shell参数
-------------

参数是存储值的实体。它可以是一个名称，数字，或下面列出来的特殊字符。变量是一个有名称标识的参数。变量有一个值及零个或多个属性。属性是通过`declare`内置命令分配的（查看4.2 Bash内置命令查看`declare`的描述）。

如果参数分配了值，那么它就被设置了。空字符串是一个有效的值。一旦变量被设置，它仅可通过内置命令`unset`来删除。

变量可以通过下面语句的形式来赋值

```bash

name=[value]
```

如果value没有给定，这个变量会被分配一个空字符串。 所有值包括波浪号扩展，参数和变量扩展，命令替换，算术扩展，和引用输出(详细如下)。如果变量设置了整数属性，那么即使不使用$((...))扩展，变量的值也会被作为算术表达式进行计算（查看3.55 算术扩展）。词分割不会被执行，除了下面解释的"$@"。文件名扩展不执行。赋值语句也可以以参数的形式出现在`alias`, `declare`, `typeset`, `export`, `readonly`和`local`内置命令(声明命令)。当在POSIX模式下(查看6.11 Bash POSIX模式)，这些内置命令也可以出现在内置命令`command`的一个或多个实例之后的命令中并保留这些赋值语句属性。

在赋值语句将一个值分配给shell变量或者数组索引(查看6.7 数组)，'+='操作符用于附加或者加到该变量的前一个值。它包含如接受赋值语句的`declare`内置命令（声明命令）的参数。当将'+ ='应用于已设置整数属性的变量时，将值作为算术表达式计算，并添加到变量的当前值中，该值也被计算。当将'+='应用于复合赋值（查看6.7 数组）的数组变量时，变量的值不是未设置的（因为它使用了'='），新值将插入到数组（索引数组）的最大索引值之后， 或作为附加键值对添加到关联数组中。当它应用于字符串型变量时，值将被扩展并附加到该变量的值。

使用带-n选项内置命令`declare`或`local`命令（查看4.2 Bash内置命令）为变量分配'nameref'属性来创建一个nameref, 或引用另一个变量。它允许变量被间接操作。无论nameref变量被引用，被分配，被删除，或属性被修改(除了使用或修改nameref属性本身)，该操作实际上是对nameref变量值指定变量的操作。nameref常用于函数内部来引用以参数传递给函数的变量。例如，如果将变量名作为第一个参数传递给函数，则运行

```bash

declare -n ref=$1
```

函数内部创建一个nameref变量ref，其值是第一个参数的变量名。引用和给ref赋值，或改变它的属性，被视为是对$1的操作。

如果for循环中的控制变量具有nameref属性，列表可以是一个shell变量列表， 并且当循环执行时，将顺序的为列表中的每个元素建立名称引用。数组变量不能被分配nameref属性。然而nameref变量可以引用数组变量和下标数组变量。nameref可以使用内置命令`unset`（查看4.1 Bourne Shell内置命令）的-n选项删除。否则，如果不加-n选项，被nameref变量引用的变量也将会被删除。

### 3.4.1 位置参数

位置参数是除了0以外的一个或者多个数字表示的参数。位置参数在shell的参数被调用时分配，并且可以使用`set`内置命令重新分配。位置参数N可以以${N}的形式引用，当N为单个数字时可以简写为$N。位置参数不能分配给赋值语句。内置命令`set`和`shift`用于设置和删除它们（查看4 shell内置命令）。当shell函数执行时，位置参数会被临时替换（查看3.3 shell函数）。

当位置参数由多个单个数字组成时，它必须用大括号括起来。

### 3.4.2 特殊参数

shell有几个特殊参数。这些参数只能被引用，不允许被赋值。

- \*

($*) 从第一个开始展开位置参数。当扩展不在双引号内，每个位置参数扩展为一个单独的词。在该参数执行的地方，这些位置参数将进一步的词分割和路径名扩展。当扩展在双引号内，它将被扩展为以特殊变量IFS的第一个字符分割的每个参数的值的单独词。也就是说，"$*"相当于"$1c$2c..."，其中c是变量IFS值的第一个字符。如果IFS没有设置，那么参数会被空白分割。如果IFS为空，会在没有中间分隔器的情况下连接参数。

- @

($@) 从第一个开始展开位置参数。当扩展在双引号内时，每个位置参数扩展为一个单独的词。也就是说，"$@" 相当于"$1" "$2" ...。如果元素内发生双引号扩展，第一个参数的扩展与原始单词的开始部分相结合， 最后一个参数的扩展与元素单词的最后部分相结合。当没有位置参数时，"$@"和$@被扩展为空（即它们被移除）。

- \#

($#) 扩展为位置参数的个数

- ?

($?) 扩展为最近执行的前台管道的退出状态。

- \-

($-, 连字符) 扩展为调用时指定的当前选项标志，有`set`内置命令或者由shell本身设置的选项标志(例如 -i 选项)。

- $

($$) 扩展为shell的进程ID。在()子shell中，它扩展为调用shell的进程ID，而不是子shell。

- !

($!) 扩展为最近置于后台执行的Job进程ID，无论这个Job是通过异步命令还是内置的`bg`命令(查看 7.2 Job控制内置命令)。

- 0

($0) 扩展为shell的名称或者shell脚本的名称。这是在shell初始化的时候设置的。如果Bash是被shell脚本调用(查看 3.8 shell脚本)，$0表示这个脚本的名称。如果Bash是以-c选项启动(查看 6.1 调用Bash)，那么$0被设置为执行字符串后的第一个参数，如果它存在。否则，它被设置为由参数0给出的用于调用Bash的文件名。

- _

($_, 下划线) 在shell启动时，设置为用于调用正在环境或参数列表中传递的shell或shell脚本的绝对路径名。然后，扩展后，扩展为上一个命令的最后一个参数。还设置为用于调用执行并放置在导出到该命令的环境中的每个命令的完整路径名。检查邮件时，此参数保存邮件文件的名称。


3.5 shell扩展
-------------

3.6 重定向
----------

3.7 执行命令
------------

3.8 shell脚本
-------------
