03 shell基本特性
================

3.1 shell语法
-------------

3.2 shell命令
-------------

3.3 shell函数
-------------

3.4 shell参数
-------------

参数是存储值的实体。它可以是一个名称，数字，或下面列出来的特殊字符。变量是一个有名称标识的参数。变量有一个值及零个或多个属性。属性是通过`declare`内置命令分配的（查看4.2 Bash内置命令查看`declare`的描述）。

如果参数分配了值，那么它就被设置了。空字符串是一个有效的值。一旦变量被设置，它仅可通过内置命令`unset`来删除。

变量可以通过下面语句的形式来赋值

```bash

name=[value]
```

如果value没有给定，这个变量会被分配一个空字符串。 所有值包括波浪号扩展，参数和变量扩展，命令替换，算术扩展，和引用输出(详细如下)。如果变量设置了整数属性，那么即使不使用$((...))扩展，变量的值也会被作为算术表达式进行计算（查看3.55 算术扩展）。词分割不会被执行，除了下面解释的"$@"。文件名扩展不执行。赋值语句也可以以参数的形式出现在`alias`, `declare`, `typeset`, `export`, `readonly`和`local`内置命令(声明命令)。当在POSIX模式下(查看6.11 Bash POSIX模式)，这些内置命令也可以出现在内置命令`command`的一个或多个实例之后的命令中并保留这些赋值语句属性。

在赋值语句将一个值分配给shell变量或者数组索引(查看6.7 数组)，'+='操作符用于附加或者加到该变量的前一个值。它包含如接受赋值语句的`declare`内置命令（声明命令）的参数。当将'+ ='应用于已设置整数属性的变量时，将值作为算术表达式计算，并添加到变量的当前值中，该值也被计算。当将'+='应用于复合赋值（查看6.7 数组）的数组变量时，变量的值不是未设置的（因为它使用了'='），新值将插入到数组（索引数组）的最大索引值之后， 或作为附加键值对添加到关联数组中。当它应用于字符串型变量时，值将被扩展并附加到该变量的值。

使用带-n选项内置命令`declare`或`local`命令（查看4.2 Bash内置命令）为变量分配'nameref'属性来创建一个nameref, 或引用另一个变量。它允许变量被间接操作。无论nameref变量被引用，被分配，被删除，或属性被修改(除了使用或修改nameref属性本身)，该操作实际上是对nameref变量值指定变量的操作。nameref常用于函数内部来引用以参数传递给函数的变量。例如，如果将变量名作为第一个参数传递给函数，则运行

```bash

declare -n ref=$1
```

函数内部创建一个nameref变量ref，其值是第一个参数的变量名。引用和给ref赋值，或改变它的属性，被视为是对$1的操作。

如果for循环中的控制变量具有nameref属性，列表可以是一个shell变量列表， 并且当循环执行时，将顺序的为列表中的每个元素建立名称引用。数组变量不能被分配nameref属性。然而nameref变量可以引用数组变量和下标数组变量。nameref可以使用内置命令`unset`（查看4.1 Bourne Shell内置命令）的-n选项删除。否则，如果不加-n选项，被nameref变量引用的变量也将会被删除。

### 3.4.1 位置参数

位置参数是除了0以外的一个或者多个数字表示的参数。位置参数在shell的参数被调用时分配，并且可以使用`set`内置命令重新分配。位置参数N可以以${N}的形式引用，当N为单个数字时可以简写为$N。位置参数不能分配给赋值语句。内置命令`set`和`shift`用于设置和删除它们（查看4 shell内置命令）。当shell函数执行时，位置参数会被临时替换（查看3.3 shell函数）。

当位置参数由多个单个数字组成时，它必须用大括号括起来。

### 3.4.2 特殊参数

shell有几个特殊参数。这些参数只能被引用，不允许被赋值。

- \*

($*) 从第一个开始展开位置参数。当扩展不在双引号内，每个位置参数扩展为一个单独的词。在该参数执行的地方，这些位置参数将进一步的词分割和路径名扩展。当扩展在双引号内，它将被扩展为以特殊变量IFS的第一个字符分割的每个参数的值的单独词。也就是说，"$*"相当于"$1c$2c..."，其中c是变量IFS值的第一个字符。如果IFS没有设置，那么参数会被空白分割。如果IFS为空，会在没有中间分隔器的情况下连接参数。

- @

($@) 从第一个开始展开位置参数。当扩展在双引号内时，每个位置参数扩展为一个单独的词。也就是说，"$@" 相当于"$1" "$2" ...。如果元素内发生双引号扩展，第一个参数的扩展与原始单词的开始部分相结合， 最后一个参数的扩展与元素单词的最后部分相结合。当没有位置参数时，"$@"和$@被扩展为空（即它们被移除）。

- \#

($#) 扩展为位置参数的个数

- ?

($?) 扩展为最近执行的前台管道的退出状态。

- \-

($-, 连字符) 扩展为调用时指定的当前选项标志，有`set`内置命令或者由shell本身设置的选项标志(例如 -i 选项)。

- $

($$) 扩展为shell的进程ID。在()子shell中，它扩展为调用shell的进程ID，而不是子shell。

- !

($!) 扩展为最近置于后台执行的Job的进程ID，无论这个Job是通过异步命令还是内置的`bg`命令(查看 7.2 Job控制内置命令)。

- 0

($0) 扩展为shell的名称或者shell脚本的名称。这是在shell初始化的时候设置的。如果Bash是被shell脚本调用(查看 3.8 shell脚本)，$0表示这个脚本的名称。如果Bash是以-c选项启动(查看 6.1 调用Bash)，那么$0被设置为执行字符串后的第一个参数，如果它存在。否则，它被设置为由参数0给出的用于调用Bash的文件名。

- _

($_, 下划线) 在shell启动时，设置为用于调用正在环境或参数列表中传递的shell或shell脚本的绝对路径名。然后，扩展后，扩展为上一个命令的最后一个参数。还设置为用于调用执行并放置在导出到该命令的环境中的每个命令的完整路径名。检查邮件时，此参数保存邮件文件的名称。


3.5 shell扩展
-------------

3.6 重定向
----------

3.7 执行命令
------------

3.8 shell脚本
-------------
